<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="133,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">qdot_ref</span>] = CLIK_pathFollowing(<span class="var type1" id="S3T24U6">Jf</span>, <span class="var type1" id="S4T24U7">Jr</span>, <span class="var type1" id="S5T6U8">T_I_f</span>, <span class="var type1" id="S6T6U9">T_I_r</span>, <span class="var type1" id="S7T4U10">pf_ref</span>, <span class="var type1" id="S8T4U11">pr_ref</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="133,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%% TASK 1 - End-effector position</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%Jf_pos = Jf(1:3,:);  %Position Jacobian</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%Jf_pos_joints = Jf(1:3,7:end); %Only interested in solving for joint angle velocities</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%J1 = Jf(1:3,7:end);</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T59:U8"><span class="var type1" id="S9T59U14">J1</span> = <span class="mxinfo " id="T59:U10"><span class="var type1" id="S3T24U16">Jf</span>(<span class="mxinfo " id="T47:U12">1:3</span>,<span class="mxinfo " id="T60:U13">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T4:U14"><span class="var type1" id="S10T4U23">pf_I</span> = <span class="mxinfo " id="T4:U16"><span class="fcn" id="F131N20:B25">tform2trvec</span>(<span class="var type1" id="S5T6U26">T_I_f</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,10" id="srcline10">10</a></span><span class="line"><span class="comment">%Pseudo-Inverse</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T124:U18"><span class="var type1" id="S12T124U29">J1_inv</span> = <span class="mxinfo " id="T124:U20"><span class="mxinfo " id="T124:U21"><span class="var type1" id="S9T59U32">J1</span>'</span>/(<span class="mxinfo " id="T7:U23"><span class="var type1" id="S9T59U35">J1</span>*<span class="mxinfo " id="T124:U25"><span class="var type1" id="S9T59U37">J1</span>'</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T4:U27"><span class="var type1" id="S13T4U40">sigma_tilde_I</span> = <span class="mxinfo " id="T4:U29"><span class="var type1" id="S7T4U42">pf_ref</span> - <span class="var type1" id="S10T4U43">pf_I</span></span></span>; <span class="comment">%pf_ref is also in intertial coordinates, i.e pf_ref = pf_ref_I</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T7:U32"><span class="var type1" id="S14T7U46">R_I_f</span> = <span class="mxinfo " id="T7:U34"><span class="fcn" id="F132N19:B48">tform2rotm</span>(<span class="var type1" id="S5T6U49">T_I_f</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T4:U36"><span class="var type1" id="S16T4U52">sigma_tilde_f</span> = <span class="mxinfo " id="T4:U38"><span class="mxinfo " id="T7:U39"><span class="var type1" id="S14T7U55">R_I_f</span>'</span>*<span class="var type1" id="S13T4U56">sigma_tilde_I</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T3:U42"><span class="var type1" id="S17T3U59">k1</span> = <span class="mxinfo " id="T3:U44">[1 1 1]*0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T7:U45"><span class="var type1" id="S17T7U69">k1</span> = <span class="mxinfo " id="T7:U47">diag(<span class="var type1" id="S17T3U72">k1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,19" id="srcline19">19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,20" id="srcline20">20</a></span><span class="line"><span class="comment">%Full position Jacobian</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T53:U49"><span class="var type1" id="S19T53U75">zeta_ref</span> = <span class="mxinfo " id="T53:U51"><span class="var type1" id="S12T124U77">J1_inv</span> * (<span class="mxinfo " id="T4:U53"><span class="mxinfo " id="T4:U54">zeros(<span class="mxinfo " id="T8:U55">3</span>,1)</span> + <span class="mxinfo " id="T4:U56"><span class="var type1" id="S17T7U85">k1</span>*<span class="var type1" id="S16T4U86">sigma_tilde_f</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo " id="T2:U59"><span class="var type1" id="S21T2U89">qdot_ref_f</span> = <span class="mxinfo " id="T2:U61">[<span class="mxinfo " id="T45:U62">zeros(<span class="mxinfo " id="T8:U63">4</span>,1)</span>; <span class="mxinfo " id="T45:U64"><span class="var type1" id="S19T53U98">zeta_ref</span>(<span class="mxinfo " id="T64:U66">7:end</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,24" id="srcline24">24</a></span><span class="line"><span class="comment">%Only joint velocities</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,25" id="srcline25">25</a></span><span class="line"><span class="comment">% qdot_ref = J1_inv * (zeros(3,1) + k1*sigma_tilde_f);</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,26" id="srcline26">26</a></span><span class="line"><span class="comment">% qdot_ref_f = [zeros(4,1); qdot_ref];</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,27" id="srcline27">27</a></span><span class="line"><span class="comment">%% TASK 2 - Rear end position</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,28" id="srcline28">28</a></span><span class="line"><span class="comment">%Jb_pos = Jr(1:3,:);</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo " id="T59:U67"><span class="var type1" id="S23T59U105">J2</span> = <span class="mxinfo " id="T59:U69"><span class="var type1" id="S4T24U107">Jr</span>(<span class="mxinfo " id="T47:U71">1:3</span>,<span class="mxinfo " id="T60:U72">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,30" id="srcline30">30</a></span><span class="line"><span class="comment">%J2 = Jr(1:3,7:end);</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T4:U73"><span class="var type1" id="S24T4U114">pr_I</span> = <span class="mxinfo " id="T4:U75"><span class="fcn" id="F131N20:B116">tform2trvec</span>(<span class="var type1" id="S6T6U117">T_I_r</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,34" id="srcline34">34</a></span><span class="line"><span class="comment">%Pseudo-Inverse</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,35" id="srcline35">35</a></span><span class="line"><span class="mxinfo " id="T124:U77"><span class="var type1" id="S25T124U120">J2_inv</span> = <span class="mxinfo " id="T124:U79"><span class="mxinfo " id="T124:U80"><span class="var type1" id="S23T59U123">J2</span>'</span>/(<span class="mxinfo " id="T7:U82"><span class="var type1" id="S23T59U126">J2</span>*<span class="mxinfo " id="T124:U84"><span class="var type1" id="S23T59U128">J2</span>'</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo " id="T4:U86"><span class="var type1" id="S13T4U131">sigma_tilde_I</span> = <span class="mxinfo " id="T4:U88"><span class="var type1" id="S8T4U133">pr_ref</span> - <span class="var type1" id="S24T4U134">pr_I</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo " id="T7:U91"><span class="var type1" id="S26T7U137">R_I_r</span> = <span class="mxinfo " id="T7:U93"><span class="fcn" id="F132N19:B139">tform2rotm</span>(<span class="var type1" id="S6T6U140">T_I_r</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo " id="T4:U95"><span class="var type1" id="S27T4U143">sigma_tilde_r</span> = <span class="mxinfo " id="T4:U97"><span class="mxinfo " id="T7:U98"><span class="var type1" id="S26T7U146">R_I_r</span>'</span>*<span class="var type1" id="S13T4U147">sigma_tilde_I</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo " id="T3:U101"><span class="var type1" id="S17T3U150">k1</span> = <span class="mxinfo " id="T3:U103">[1 1 1]*0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo " id="T7:U104"><span class="var type1" id="S17T7U160">k1</span> = <span class="mxinfo " id="T7:U106">diag(<span class="var type1" id="S17T3U163">k1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,43" id="srcline43">43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,44" id="srcline44">44</a></span><span class="line"><span class="comment">%Full position Jacobian</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,45" id="srcline45">45</a></span><span class="line"><span class="mxinfo " id="T53:U108"><span class="var type1" id="S19T53U166">zeta_ref</span> = <span class="mxinfo " id="T53:U110"><span class="var type1" id="S25T124U168">J2_inv</span> * (<span class="mxinfo " id="T4:U112"><span class="mxinfo " id="T4:U113">zeros(<span class="mxinfo " id="T8:U114">3</span>,1)</span> - <span class="mxinfo " id="T4:U115"><span class="var type1" id="S17T7U176">k1</span>*<span class="var type1" id="S27T4U177">sigma_tilde_r</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,46" id="srcline46">46</a></span><span class="line"><span class="mxinfo " id="T2:U118"><span class="var type1" id="S28T2U180">qdot_ref_r</span> = <span class="mxinfo " id="T2:U120">[<span class="mxinfo " id="T8:U121"><span class="var type1" id="S19T53U184">zeta_ref</span>(<span class="mxinfo " id="T8:U123">10</span>)</span>; <span class="mxinfo " id="T8:U124"><span class="var type1" id="S19T53U188">zeta_ref</span>(<span class="mxinfo " id="T8:U126">9</span>)</span>; <span class="mxinfo " id="T8:U127"><span class="var type1" id="S19T53U192">zeta_ref</span>(<span class="mxinfo " id="T8:U129">8</span>)</span>; <span class="mxinfo " id="T8:U130"><span class="var type1" id="S19T53U196">zeta_ref</span>(<span class="mxinfo " id="T8:U132">7</span>)</span>; <span class="mxinfo " id="T45:U133">zeros(<span class="mxinfo " id="T8:U134">4</span>,1)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,47" id="srcline47">47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,48" id="srcline48">48</a></span><span class="line"><span class="comment">%Only joints</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,49" id="srcline49">49</a></span><span class="line"><span class="comment">% qdot_ref = J2_inv * (zeros(3,1) - k1*sigma_tilde_r);</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,50" id="srcline50">50</a></span><span class="line"><span class="comment">% qdot_ref_r = [qdot_ref(4); qdot_ref(3); qdot_ref(2); qdot_ref(1); zeros(4,1)];</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,51" id="srcline51">51</a></span><span class="line"><span class="comment">%% Total</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,52" id="srcline52">52</a></span><span class="line"><span class="mxinfo " id="T2:U135"><span class="var type1" id="S2T2U205">qdot_ref</span> = <span class="mxinfo " id="T2:U137"><span class="var type1" id="S21T2U207">qdot_ref_f</span> + <span class="var type1" id="S28T2U208">qdot_ref_r</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,53" id="srcline53">53</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
